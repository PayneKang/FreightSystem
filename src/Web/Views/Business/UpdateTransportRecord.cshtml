@using FreightSystem.Models;
@model FreightSystem.Models.TransportRecordModel
@{
    UserModel loggedUser = (UserModel)ViewBag.LoggedUser;
}
<script language="javascript" type="text/javascript" src="/Scripts/My97DatePicker/WdatePicker.js"></script>
<br />
<div class="row">
    <div class="large-6 columns">
        <fieldset>
            <legend>详细信息</legend>
            @using (Html.BeginForm())
            {
                <input type="hidden" name="actionType" value="updtRecord" />
                <div class="row">
                    <br />
                    <div class="large-5 large-offset-0-1 columns">
                        <label>
                            发货日期</label>
                        @Html.TextBoxFor(m => m.DeliverDate, new { @class = "Wdate", @Value = Model.DeliverDate.ToString("yyyy-MM-dd"), @onclick = "WdatePicker()", @style = "margin-bottom:0px" })
                        <small class="error">@Html.ValidationMessageFor(m => m.DeliverDate)</small>
                    </div>
                    <div class="large-5 large-offset-0-1 columns">
                        <label>
                            客户</label>
                        @Html.DropDownListFor(m => m.ClientName, (List<SelectListItem>)ViewBag.Clients, new { @type = "text", @style = "margin-bottom:0px", @placeholder = "必填" })
                        <small class="error">@Html.ValidationMessageFor(m => m.ClientName)</small>
                    </div>
                    <div class="large-5 large-offset-0-1 columns">
                        <label>
                            驾驶员</label>
                        @Html.TextBoxFor(m => m.Driver, new { @type = "text", @style = "margin-bottom:0px", @placeholder = "必填" })
                        <small class="error">@Html.ValidationMessageFor(m => m.Driver)</small>
                    </div>
                    <div class="large-5 large-offset-0-1 columns">
                        <label>
                            车牌号</label>
                        @Html.TextBoxFor(m => m.CarLicense, new { @type = "text", @style = "margin-bottom:0px", @placeholder = "必填" })
                        <small class="error">@Html.ValidationMessageFor(m => m.CarLicense)</small>
                    </div>
                    <div class="large-5 large-offset-0-1 columns">
                        <label>
                            托编号</label>
                        @Html.TextBoxFor(m => m.TrayNo, new { @type = "text", @style = "margin-bottom:0px" })
                        <small class="error">@Html.ValidationMessageFor(m => m.TrayNo)</small>
                    </div>
                    <div class="large-5 large-offset-0-1 columns">
                        <label>
                            物品名称</label>
                        @Html.TextBoxFor(m => m.PackageName, new { @type = "text", @style = "margin-bottom:0px", @placeholder = "必填" })
                        <small class="error">@Html.ValidationMessageFor(m => m.PackageName)</small>
                    </div>
                    <div class="large-5 large-offset-0-1 columns">
                        <label>
                            起运地</label>
                        @Html.TextBoxFor(m => m.FromLocation, new { @type = "text", @style = "margin-bottom:0px", @placeholder = "必填" })
                        <small class="error">@Html.ValidationMessageFor(m => m.FromLocation)</small>
                    </div>
                    <div class="large-5 large-offset-0-1 columns">
                        <label>
                            卸货地 / 单位</label>
                        @Html.TextBoxFor(m => m.ToLocation, new { @type = "text", @style = "margin-bottom:0px", @placeholder = "必填" })
                        <small class="error">@Html.ValidationMessageFor(m => m.ToLocation)</small>
                    </div>
                    <div class="large-5 large-offset-0-1 columns">
                        <label>
                            专线/司机电话</label>
                        @Html.TextBoxFor(m => m.DeliverType, new { @type = "text", @style = "margin-bottom:0px" })
                        <small class="error">@Html.ValidationMessageFor(m => m.DeliverType)</small>
                    </div>
                    <div class="large-5 large-offset-0-1 columns">
                        <label>
                            预付</label>
                        @Html.TextBoxFor(m => m.PrePay, new { @type = "text", @style = "margin-bottom:0px" })
                        <small class="error">@Html.ValidationMessageFor(m => m.PrePay)</small>
                    </div>
                    <div class="large-5 large-offset-0-1 columns">
                        <label>
                            油卡</label>
                        @Html.TextBoxFor(m => m.OilCard, new { @type = "text", @style = "margin-bottom:0px" })
                        <small class="error">@Html.ValidationMessageFor(m => m.OilCard)</small>
                    </div>
                    <div class="large-5 large-offset-0-1 columns">
                        <label>
                            装卸费</label>
                        @Html.TextBoxFor(m => m.HandlingFee, new { @type = "text", @style = "margin-bottom:0px" })
                        <small class="error">@Html.ValidationMessageFor(m => m.HandlingFee)</small>
                    </div>
                    <div class="large-5 large-offset-0-1 columns">
                        <label>
                            运费</label>
                        @Html.TextBoxFor(m => m.DeliverPrice, new { @type = "text", @style = "margin-bottom:0px" })
                        <small class="error">@Html.ValidationMessageFor(m => m.DeliverPrice)</small>
                    </div>
                    <div class="large-5 large-offset-0-1 columns">
                        <label>
                            短驳费</label>
                        @Html.TextBoxFor(m => m.ShortBargeFee, new { @type = "text", @style = "margin-bottom:0px" })
                        <small class="error">@Html.ValidationMessageFor(m => m.ShortBargeFee)</small>
                    </div>
                    <div class="large-5 large-offset-0-1 columns">
                        <label>
                            体积</label>
                        @Html.TextBoxFor(m => m.Volume, new { @type = "text", @style = "margin-bottom:0px" })
                        <small class="error">@Html.ValidationMessageFor(m => m.Volume)</small>
                    </div>
                    <div class="large-5 large-offset-0-1 columns">
                        <label>
                            数量</label>
                        @Html.TextBoxFor(m => m.Quantity, new { @type = "text", @style = "margin-bottom:0px" })
                        <small class="error">@Html.ValidationMessageFor(m => m.Quantity)</small>
                    </div>
                    <div class="large-5 large-offset-0-1 columns">
                        <label>
                            到货时间</label>
                        @Html.TextBoxFor(m => m.ReceivedDate, new { @type = "text", @Value = Model.ReceivedDate.HasValue ? Model.ReceivedDate.Value.ToString("yyyy-MM-dd") : "", @style = "margin-bottom:0px" })
                        <small class="error">@Html.ValidationMessageFor(m => m.ReceivedDate)</small>
                    </div>
                    <div class="large-5 large-offset-0-1 columns">
                        <label>
                            扣款</label>
                        @Html.TextBoxFor(m => m.Deductions, new { @type = "text", @style = "margin-bottom:0px" })
                        <small class="error">@Html.ValidationMessageFor(m => m.Deductions)</small>
                    </div>
                    <div class="large-5 large-offset-0-1 columns">
                        <label>
                            赔款</label>
                        @Html.TextBoxFor(m => m.Reparations, new { @type = "text", @style = "margin-bottom:0px" })
                        <small class="error">@Html.ValidationMessageFor(m => m.Reparations)</small>
                    </div>
                    <div class="large-5 large-offset-0-1 columns">
                        <label>
                            应付金额</label>
                        @Html.TextBoxFor(m => m.AccountPayble, new { @type = "text", @style = "margin-bottom:0px" })
                        <small class="error">@Html.ValidationMessageFor(m => m.AccountPayble)</small>
                    </div>
                    <div class="large-5 large-offset-0-1 columns">
                        <label>
                            付款时间</label>
                        @Html.TextBoxFor(m => m.PayDate, new { @type = "text", @Value = Model.PayDate.HasValue ? Model.PayDate.Value.ToString("yyyy-MM-dd") : "", @style = "margin-bottom:0px" })
                        <small class="error">@Html.ValidationMessageFor(m => m.PayDate)</small>
                    </div>
                    <div class="large-12 large-offset-0-1 columns">
                        <label>
                            备注</label>
                        @Html.TextAreaFor(m => m.Comment, new { @style = "width:87%;height:80px;margin-bottom:0px" })
                        <small class="error">@Html.ValidationMessageFor(m => m.Comment)</small>
                    </div>
                    <div class="large-3 large-offset-0-1 columns">
                        是否正常：@Html.CheckBoxFor(m => m.Error)
                    </div>
                    <div class="large-3 large-offset-0-1 columns">
                        是否到货：@Html.CheckBoxFor(m => m.Received)
                    </div>
                    <div class="large-3 large-offset-0-1 columns">
                        是否结算 ：@Html.CheckBoxFor(m => m.Paid)
                    </div>
                    <div class="large-3 large-offset-0-1 columns">
                        <br />
                        <label>
                            所在业务区域</label>
                    </div>
                    <div class="large-3 large-offset-0-1 columns">
                        <br />
                        @Html.LabelFor(m => m.BusinessArea, ((UserModel)ViewBag.LoggedUser).Area.AreaName, new { @class = "left" })
                        @Html.Hidden("businessarea", ((UserModel)ViewBag.LoggedUser).Area.AreaName)
                    </div>
                    <div class="large-3 large-offset-0-1 columns">
                        <input type="submit" class="button tiny" style="margin-top: 1rem" value="修改" />
                    </div>
                </div>
                if (string.IsNullOrEmpty(Model.TrayNo))
                {
                <script language="javascript">
                    $("#TrayNo").val("@ViewBag.DefaultTrayNo");
                </script>
                }
            }
        </fieldset>
    </div>
    <div class="large-6 columns">
        <fieldset>
            <legend>货物明细</legend>
            <table class="table-cell-spacing large-12">
                <thead>
                    <tr>
                        <th>
                            单据号
                        </th>
                        <th>
                            货品名称
                        </th>
                        <th>
                            数量
                        </th>
                        <th>
                            体积
                        </th>
                        <th>
                            操作
                        </th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.DetailItem != null)
                    {
                        foreach (TransportRecordDetailModel detail in Model.DetailItem)
                        {
                        <tr>
                            <td>@detail.DetailNo
                            </td>
                            <td>@detail.PackageName
                            </td>
                            <td>@detail.Quantity
                            </td>
                            <td>@detail.Volume
                            </td>
                            <td>
                                @if (loggedUser.Role.AccessList.Contains("ALL") || loggedUser.Role.AccessList.Contains("NEWRD"))
                                {
                                    <a class="left" href="/Business/UpdateDetails/@detail.ID">编辑</a><a class="right" href="/Business/DeleteDetails/@detail.ID" onclick="return confirm('确定要删除此明细？');">删除</a>                    
                                }
                            </td>
                        </tr>
                        }
                    }
                </tbody>
            </table>
        </fieldset>
        <br />
        @using (Html.BeginForm("DetailsMgr", "Business"))
        {
            <input type="hidden" name="actionType" value="fillDetails" />
            <fieldset>
                <legend>新增货物明细</legend>
                @using (Html.BeginForm())
                {
                    <input type="hidden" name="recordID" value="@Model.ID" />
                    <div class="row">
                        <br />
                        <div class="large-5 large-offset-0-1 columns">
                            <label>
                                单据编号</label>
                            <input type="text" name="detailNo" />
                        </div>
                        <div class="large-5 large-offset-0-1 columns">
                            <label>
                                货物名称</label>
                            <input type="text" name="packagename" />
                        </div>
                        <div class="large-5 large-offset-0-1 columns">
                            <label>
                                数量</label>
                            <input type="text" name="quantity" />
                        </div>
                        <div class="large-5 large-offset-0-1 columns">
                            <label>
                                体积</label>
                            <input type="text" name="volume" />
                        </div>
                        <div class="large-11 columns">
                            <button type="submit" class="left button tiny" style="margin-top: 1rem">
                                新增</button>
                        </div>
                    </div>
                }
            </fieldset>
        }
        <br />
        @Html.Partial("_TransportRecordHistoryPartial", Model)
    </div>
</div>
<br />
